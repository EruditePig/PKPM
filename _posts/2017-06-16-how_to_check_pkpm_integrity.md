---
layout: post
title: "如何进行PKPM完整性检查"
comments: false
description: ""
keywords: ""
---

### 完整性检查的目的

在软件使用过程中，由于
- 杀毒软件误杀（真的是误杀，我们还没有技术能力写出病毒来）
- 用户误操作删除程序文件
- ...等等其他原因

导致程序运行时发生崩溃

通常这种原因问到我们开发人员这，我们也很崩溃，因为这种问题很难查啊~而经常查到问题的原因就是文件缺失或者和发行版本不匹配。因此，我们做了一个完整性检查的程序，来检查用户电脑上安装的PKPM版本的完整性。


### 完整性检查程序在哪？

PKPM安装目录\CFG\PKPMIntegrityCheck.exe

### 如何操作

1. 双击执行，在下拉框中选择对应版本

![]({{site.imgurl}}pkpm_integrity_exe.png)

2. 点击“检查一致性”，选择该版本的安装目录，然后程序就自动开始检查。

![]({{site.imgurl}}choose_pkpm_install_dir.png)
![]({{site.imgurl}}during_check_integrity.png)

3. 如果安装目录和发行版不一致，则会在记事本中输出具体差异项。

![]({{site.imgurl}}check_integrity_result.png)

### 完整性检查后弹出的文本如何解读

以上图的检查结果为例，程序输出了“3个错误，4个警告”。由于PKPM程序在运行过程中也会记录下一些配置信息、用户自定义信息（如自定义型钢截面）等，因此安装目录下有些文件会随着用户的使用而改变，但exe和dll等可执行文件一般不会改变。程序检查到和发行版不一致的文件后，会把可执行文件列为**错误**，其他文件列为**警告**。一般来说，仅仅关注造成可执行文件差异的原因即可。

另外，报告中提到的“缺失的文件”指的是发行版中存在，但在安装目录下不存在的文件；“不一致的文件”指的是安装目录下和发行版中都存在，但比对后和发行版不一致的文件；“安装目录下多余的文件”指的是发行版中布不存在但安装目录下存在的文件。

### 软件原理

每个PKPM发行版在发布前，都会对安装文件计算一遍MD5值，并生成相关的配置文件放在光盘里。检查的时候同样遍历一遍安装目录下各个文件，和配置文件中的MD5值进行比对。